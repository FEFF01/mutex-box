!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var o in r)("object"==typeof exports?exports:e)[o]=r[o]}}(window,(function(){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([,function(e,t,r){"use strict";var o,n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.USE_CHECK=1]="USE_CHECK",e[e.FILL_EACHMODEL=16]="FILL_EACHMODEL",e[e.USE_OFFSET=256]="USE_OFFSET",e[e.USE_EACHOFFSET=4096]="USE_EACHOFFSET"}(o||(o={}));var i=function(){function e(e,t){void 0===t&&(t=e.reduce((function(e,t){return Math.max(e,(t.col||0)+(t.colspan||1))}),1)),this.model_map=new Array,this.model_list=new Array,this._ncols=null,this.model_list=this.model_list.concat(e),this.ncols=t}return Object.defineProperty(e.prototype,"ncols",{get:function(){return this._ncols},set:function(t){if(t!==this._ncols){this._ncols=t,this.model_map.splice(0,this.model_map.length);var r=this.model_list.splice(0,this.model_list.length),o=this._fill(r,e.STATES.USE_CHECK|e.STATES.FILL_EACHMODEL);this.append(o)}},enumerable:!0,configurable:!0}),e.prototype.fill=function(t){t instanceof Array||(t=[t]),this._fill(t,e.STATES.FILL_EACHMODEL)},e.prototype.clear=function(e){var t=this.model_list.indexOf(e),r=0;for(~t||this.model_list.splice(t,1);~(t=this.model_map.indexOf(e));)r++,this.model_map[t]=void 0;return r},e.prototype.remove=function(e){e instanceof Array||(e=[e]),this._fill(e)},e.prototype.move=function(t,r,o){void 0===o&&(o=0),t instanceof Array||(t=[t]),this.remove(t),this._fill(t,o|e.STATES.FILL_EACHMODEL|e.STATES.USE_OFFSET,r)},e.prototype.getModel=function(e,t){if(e>=0&&t>=0&&e<this.ncols)return this.model_map[e+t*this.ncols]},e.prototype.format=function(e,t,r){return void 0===t&&(t=e.col),void 0===r&&(r=e.row),e.col=Math.round(Math.max(Math.min(t,this.ncols-e.colspan),0)),e.row=Math.round(Math.max(r,0)),e},e.prototype.trim=function(){for(var e=Math.ceil(this.model_map.length/this.ncols),t=[],r=1;r<e;r++)for(var o=0;o<this.ncols;o++){var n=r*this.ncols+o,i=this.model_map[n];if(i&&i.row===r){var s=this._pathTest([i],[0,-r-1],i);s>0&&(t.push(i),this.move([i],[0,-s])),o+=i.colspan-1}}return t},e.prototype.append=function(t){t instanceof Array||(t=[t]);for(var r=0,o=t;r<o.length;r++){var n=o[r];n.colspan>this.ncols&&(n.colspan=this.ncols);for(var i=Math.ceil(this.model_map.length/this.ncols),s=0,a=0,c={col:0,row:i,colspan:n.colspan,rowspan:n.rowspan},l=0,u=this.ncols-n.colspan;l<=u;l++){c.col=l;var p=this._pathTest([c],[0,-i-1],c);s<p&&(s=p,a=l)}n.col=a,n.row=i-s,this._fill([n],e.STATES.FILL_EACHMODEL)}},e.prototype.alloc=function(t,r){var o=this.format(n({},t)),i=this.cover(o),s=i.slice();if(0===i.length)return s;var a=this.calcWrap(i);if(r&&o.col===a.col&&o.row===a.row&&r.colspan===a.colspan&&r.rowspan===a.rowspan&&(Math.abs(t.col-a.col)+Math.abs(t.row-a.row))/(r.colspan+r.rowspan)<.06&&Math.abs(r.col-a.col)/r.colspan+Math.abs(r.row-a.row)/r.rowspan>1)this.move(i,[r.col-a.col,r.row-a.row]);else if(i.length>1&&a.colspan+a.rowspan>2*(o.colspan+o.rowspan)||!this._compress(o,i,a,t)){for(var c=0;c<i.length;c++)this._compress(o,[i[c]],i[c],void 0,!1)&&i.splice(c--,1);if(0===i.length)return s;var l=[],u=[];a=this.calcWrap(i);for(var p=o.colspan-Math.max(a.col-o.col,0)-Math.max(o.col+o.colspan-a.colspan-a.col,0),f=[{col:Math.max(o.col,a.col),row:o.row,colspan:p,rowspan:0}],_={},h=[new Array(p).fill(o.rowspan)];f.length;){var d=[],v={},y=[];for(var E in _)_[E].sort((function(e,t){return e.row-t.row}));for(c=0;c<f.length;c++){for(var m=f[c],g=h[c],w=(T=m.col)+m.colspan;T<w;T++){if(C=_[T]){for(var O=0,b=0;b<C.length-1;b++){var S=C[b];if(!(S.row<m.row))break;O+=C[b+1].row-(S.row+S.rowspan)}g[T-m.col]-=O}}if((M=Math.max.apply(Number,g))>0)if(h[c]=M,-1===(b=l.indexOf(m)))b=l.length,l.push(m),u.push(M);else{if(u[b]>=M)continue;u[b]=M}else f.splice(c,1),h.splice(c,1),c--}for(b=0;b<f.length;b++){m=f[b];var M=h[b];var T=m.col;e:for(w=T+m.colspan;T<w;T++)for(var k=m.row+m.rowspan,x=k+M;k<x;k++){var A=this.model_map[T+k*this.ncols];if(A){var P=d.indexOf(A),U=(g=void 0,x-k+Math.max(m.row-A.row,0));if(-1===P){var C,L=l.indexOf(A);if(L>=0&&u[L]>=U)continue e;d.push(A),y.push(g=new Array(A.colspan).fill(0)),(C=v[T]||(v[T]=[])).push({row:A.row,rowspan:A.rowspan})}else g=y[P];g[T-A.col]=Math.max(g[T-A.col],U);break}}}f=d,_=v,h=y}l.splice(0,1),u.splice(0,1),this.move(l,u.map((function(e){return[0,e]})),e.STATES.USE_EACHOFFSET),s=s.concat(l)}return s},e.prototype.cover=function(e){for(var t=[],r=e.col,o=e.row,n=0;n<e.rowspan;n++)for(var i=0;i<e.colspan;i++){var s=this.model_map[i+r+(n+o)*this.ncols];if(void 0!==s){~t.indexOf(s)||t.push(s);var a=s.colspan+s.col-1;i+r<a&&(i=a-r)}}return t},e.prototype.calcWrap=function(e){for(var t={col:e[0].col,row:e[0].row,colspan:e[0].colspan,rowspan:e[0].rowspan},r=1;r<e.length;r++){var o=e[r];t.col>o.col&&(t.colspan+=t.col-o.col,t.col=o.col),t.row>o.row&&(t.rowspan+=t.row-o.row,t.row=o.row),t.colspan+t.col<o.col+o.colspan&&(t.colspan+=o.col+o.colspan-t.col-t.colspan),t.rowspan+t.row<o.row+o.rowspan&&(t.rowspan+=o.row+o.rowspan-t.row-t.rowspan)}return t},e.prototype.calcOffset=function(e,t){return{l:e.col-(t.col+t.colspan),r:e.col+e.colspan-t.col,t:e.row-(t.row+t.rowspan),b:e.row+e.rowspan-t.row}},e.prototype._fill=function(t,r,o){void 0===r&&(r=0);var n=e.STATES,i=r&n.USE_CHECK?[]:void 0,s=this.model_map,a=this.model_list,c=this.ncols;e:for(var l=0;l<t.length;l++){var u=t[l];if(r&n.USE_CHECK&&(isFinite(u.colspan)||(u.colspan=1),isFinite(u.rowspan)||(u.rowspan=1),isNaN(u.col+u.row)||u.col+u.colspan>c))i.push(u);else{var p=a.indexOf(u);if(r&n.FILL_EACHMODEL){if(-1!==p)continue;a.push(u)}else p>=0&&a.splice(p,1);r&n.USE_EACHOFFSET?(u.col+=o[l][0],u.row+=o[l][1]):r&n.USE_OFFSET&&(u.col+=o[0],u.row+=o[1]);for(var f=u.col,_=u.row,h=u.colspan,d=u.rowspan,v=0;v<d;v++)for(var y=0;y<h;y++){var E=y+f+(v+_)*c;if(r&n.USE_CHECK&&void 0!==s[E]){do{for(;y--;)s[y+f+(v+_)*c]=void 0;y=h}while(v--);r&n.FILL_EACHMODEL&&a.pop(),i.push(u);continue e}s[E]=r&n.FILL_EACHMODEL?u:o}}}return i},e.prototype._pathTest=function(e,t,r){void 0===r&&(r=this.calcWrap(e));for(var o=0|t[0],n=0|t[1],i=0,s=0,a=0,c=o&&o/Math.abs(o),l=n&&n/Math.abs(n);i!==o||s!==n;){if(i!==o?i+=c:s+=l,r.col+i<0||r.col+i+r.colspan>this.ncols||r.row+s<0)return a;for(var u=0,p=e;u<p.length;u++)for(var f=p[u],_=f.row,h=_+f.rowspan;_<h;_++)for(var d=f.col,v=d+f.colspan;d<v;d++){var y=d+i+(_+s)*this.ncols;if(this.model_map[y]&&-1===e.indexOf(this.model_map[y]))return a}a+=1}return!0},e.prototype._compress=function(e,t,r,o,n){void 0===t&&(t=this.cover(e)),void 0===r&&(r=this.calcWrap(t)),void 0===n&&(n=!0);var i=e.rowspan/e.colspan,s=r.colspan/r.rowspan,a=this.calcOffset(e,r),c=o?this.calcOffset(o,r):a,l=[Math.abs(i*c.l),[a.l,0]],u=[Math.abs(i*c.r),[a.r,0],l];l.push(u),u.push(l);var p,f=[Math.abs(s*c.t),[0,a.t]];n&&(p=[Math.abs(s*c.b),[0,a.b]],f.push(p),p.push(f));for(var _=(n?[l,u,f,p]:[l,u,f]).sort((function(e,t){return e[0]-t[0]})),h=0;h<_.length;h++){var d=_.lastIndexOf(_[h][2]);if(d>h&&(_.splice(d,1),_.splice(h+1,0,_[h][2])),!0===this._pathTest(t,_[h][1],r))return this.move(t,_[h][1]),!0}return!1},e.STATES=o,e}();t.default=i},,function(e,t,r){"use strict";var o,n=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),s=r(4),a=function(e){function t(t,r,o){void 0===o&&(o={});var n=e.call(this,r,o.ncols)||this;return n.vessel=t,n.inputListener=null,n.space={top:0,right:0,bottom:0,left:0},n.capture={top:0,right:0,bottom:0,left:0},n.target_box=null,n._longtap_timeout=null,n._client_width=0,n.dragStart=function(e,t){var r=n.vessel.getBoundingClientRect(),o=t.clientX-r.left,i=t.clientY-r.top;return n.target_box=n._get_box(o,i,e,t),!n.target_box||(e.preventDefault(),n.target_box.dragging=!0,void n.remove(n.target_box))},n.dragMove=function(e,t){n.target_box.left+=t[0],n.target_box.top+=t[1],n._longtap_timeout&&(window.clearTimeout(n._longtap_timeout),n._longtap_timeout=null),n._longtap_timeout=window.setTimeout(n._put_box,300)},n.dragEnd=function(e){n._longtap_timeout&&window.clearTimeout(n._longtap_timeout),n._put_box(!0)},n._window_resize=function(e){n._client_width!==n.vessel.clientWidth&&(n._client_width=n.vessel.clientWidth,n._update(n.model_list))},n._put_box=function(e){n._longtap_timeout=null;var t=n.target_box,r=n.cellSize,o=t.left/r,i=t.top/r;n.alloc({col:o,row:i,colspan:t.colspan,rowspan:t.rowspan},t),!0===e&&(t.dragging=!1,n.format(t,o,i),n.fill(t),n._update([t]),n.target_box=null)},n.vessel=t,n.inputListener=new s(t,{dragStart:n.dragStart,dragMove:n.dragMove,dragEnd:n.dragEnd}),n.resize(o),n.activate(),n}return n(t,e),t.prototype.disable=function(){window.removeEventListener("resize",this._window_resize),this.inputListener.disable()},t.prototype.activate=function(){this._window_resize(),window.addEventListener("resize",this._window_resize),this.inputListener.activate()},t.prototype.trim=function(){this._update(e.prototype.trim.call(this))},t.prototype.alloc=function(t,r){this._update(e.prototype.alloc.call(this,t,r))},t.prototype.remove=function(t){e.prototype.remove.call(this,t)},t.prototype.add=function(e){e instanceof Array||(e=[e]);for(var t=0,r=e;t<r.length;t++){var o=r[t];o.col>=0&&o.col+o.colspan<=this.ncols&&o.row>=0?(this.alloc(o),this.fill(o)):this.append(o)}this._update(e)},t.prototype.resize=function(e){e instanceof Object?(e.space&&(this.space=e.space),e.capture&&(this.capture=e.capture),isNaN(e.ncols)||(this.ncols=e.ncols)):this.ncols=e,this._client_width=this.vessel.clientWidth,this.update()},t.prototype.update=function(e,t){if(e){if(t instanceof Object)for(var r in t)e[r]=t[r];this.clear(e),this.alloc(e),this.fill(e),this._update([e])}else this._update(this.model_list)},t.prototype._update=function(e){for(var t,r,o,n,i=this.cellSize,s=0,a=e;s<a.length;s++){var c=a[s],l=c.space||this.space,u=l.left,p=void 0===u?0:u,f=l.right,_=void 0===f?0:f,h=l.top,d=void 0===h?0:h,v=l.bottom,y=void 0===v?0:v;t=i*c.col+p,r=i*c.row+d,o=i*c.colspan-p-_,n=i*c.rowspan-d-y,t!==c.left&&(c.left=t),r!==c.top&&(c.top=r),o!==c.width&&(c.width=o),n!==c.height&&(c.height=n)}},Object.defineProperty(t.prototype,"cellSize",{get:function(){return this._client_width/this.ncols},enumerable:!0,configurable:!0}),t.prototype._get_box=function(e,t,r,o){var n=this.cellSize,i=this.getModel(e/n|0,t/n|0);function s(e,t,r){return r>=0?t<e-r:t>=e+r&&t<e}if(i){var a=i.capture||this.capture;if(a instanceof Function){var c=a(r,o,i);return!0===c?i:!1===c?void 0:c}var l=i.space||this.space,u=l.top,p=void 0===u?0:u,f=l.right,_=void 0===f?0:f,h=l.bottom,d=void 0===h?0:h,v=l.left,y=void 0===v?0:v,E=a.top,m=void 0===E?0:E,g=a.right,w=void 0===g?0:g,O=a.bottom,b=void 0===O?0:O,S=a.left,M=void 0===S?0:S,T=i.col*n+y,k=i.row*n+p,x=i.colspan*n-_-y,A=i.rowspan*n-p-d,P=e-T-x/2,U=t-k-A/2,C=Math.sqrt(Math.pow(P,2)+Math.pow(U,2)),L=Math.atan2(U,P),D=2*Math.atan(x/A),H=(Math.PI-D)/2,N=Math.PI/2;switch(!0){case L<-H&&L>-D-H:return s(A/2,C*Math.cos(N+L),m)&&i;case Math.abs(L)<=H:return s(x/2,C*Math.cos(L),w)&&i;case L>H&&L<H+D:return s(A/2,Math.abs(C*Math.cos(N+L)),b)&&i;case Math.abs(L)>=D+H:return s(x/2,Math.abs(C*Math.cos(L)),M)&&i}}},t.MutexModel=i.default,t}(i.default);try{window.MutexBox=a}catch(e){}e.exports=a},function(e,t,r){window,e.exports=function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function p(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),e}var f={rotate:/^rotate$/,pinch:/^pinch$/,dragMove2:/^dragMove2$/,dragStart:/^dragStart$/,dragMove:/^dragMove$/,dragEnd:/^dragEnd$/,click:/^click$/},_=function(){function e(t,r){l(this,e),this._activated_listener={},this._registered_listener={rotate:null,pinch:null,dragMove:null,dragStart:null,dragEnd:null,dragMove2:null,click:null,keyDown:{_parts:[],_reference:0},keyUp:{_reference:0},keyPress:{_reference:0}},this._bm=1,this.target=null,this._listener_options=void 0,this._listener_status={},this._points=[],this._identifiers=[],this.target=t,this._listener_options=r}return p(e,[{key:"setListener",value:function(e){for(var t in e)if(!this._listener_status[t]!=!e[t]){var r=h.EVENT_CONFIG[t],o=r[0],n=r[1],i=r[2]||this.target;e[t]?i.addEventListener(o,this[n],this._listener_options):i.removeEventListener(o,this[n],this._listener_options),this._listener_status[t]=!!e[t]}}},{key:"eventDispenser",value:function(e,t){if(this._identifiers[0]===h.MOUSE_EVENT_ID)Math.pow(2,e.button)&this._bm&&t(e,e,0);else if(e.changedTouches)for(var r=0;r<e.changedTouches.length;r++){var o=this._identifiers.indexOf(e.changedTouches[r].identifier);-1!==o&&t(e,e.changedTouches[r],o)}}},{key:"_is_mouse_event",get:function(){return this._identifiers[0]===h.MOUSE_EVENT_ID}}]),e}();_.EVENT_CONFIG={MOUSE_DOWN:["mousedown","cursorDown"],MOUSE_MOVE:["mousemove","cursorMove",window],MOUSE_UP:["mouseup","cursorUp",window],TOUCH_START:["touchstart","cursorDown"],TOUCH_MOVE:["touchmove","cursorMove",window],TOUCH_END:["touchend","cursorUp",window],TOUCH_CANCEL:["touchcancel","cursorUp",window],KEY_DOWN:["keydown","keyDown"],KEY_UP:["keyup","keyUp"],KEY_PRESS:["keypress","keyPress"]},_.CURSOR_EVENT_HANDLES=Object.keys(f),_.STATES={IS_DRAG:1,IS_ROTATE:2,IS_PINCH:4,MOUSE_DOWN:"MOUSE_DOWN",MOUSE_MOVE:"MOUSE_MOVE",MOUSE_UP:"MOUSE_UP",TOUCH_START:"TOUCH_START",TOUCH_MOVE:"TOUCH_MOVE",TOUCH_END:"TOUCH_END",TOUCH_CANCEL:"TOUCH_CANCEL",KEY_DOWN:"KEY_DOWN",KEY_UP:"KEY_UP",KEY_PRESS:"KEY_PRESS"},_.PATTERN_MAP=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},f,{},{keyDown:/^\S+_keyDown$/,keyUp:/^\S+_keyUp$/,keyPress:/^\S+_keyPress$/}),_.MOUSE_EVENT_ID=-9007199254740991,_._PRIVATE_METHODS={update_key_listener:function(e,t,r,o){h._PRIVATE_METHODS.match_keys(t,(function(t){var n=e[t];n||(n=e[t]=[]);var i=n.indexOf(r);o?i>=0&&(e._reference--,n.length>1?n.splice(i,1):delete e[t]):(e._reference++,~i||n.push(r))}))},match_keys:function(e,t){var r=e.match(/(\w+?|\ )(?=$|\||\,|\+)/g);if(r=r?r.map((function(e){return e.toLocaleLowerCase()})):[],!t)return r;var o=r,n=Array.isArray(o),i=0;for(o=n?o:o[Symbol.iterator]();;){var s;if(n){if(i>=o.length)break;s=o[i++]}else{if((i=o.next()).done)break;s=i.value}if(t(s))break}},get_keys:function(e){return e.code&&e.key!==e.code?[e.key.toLocaleLowerCase(),e.code.toLocaleLowerCase()]:[e.key.toLocaleLowerCase()]}},_._LISTENER_PREPROCESSOR={keyDown:function(e,t,r){var o,n=e.slice(0,-8).split(","),i=r?function(e,r,o){if(o){var n=e[r];if(n){var i=n._listeners.indexOf(t);-1!==i&&(n._listeners.splice(i,1),function e(t){var r=t._parent;--t._reference<=0&&r&&(delete r[t._key],e(r))}(n))}}}:function(e,r,n){var i=e[r];i||((i=e[r]={_parent:e,_key:r,_reference:0,_parts:e._parts.concat(r)})._path=i._parts.join("+"),e._reference++),o.push(i),n&&(i._reference++,i._listeners?-1===i._listeners.indexOf(t)&&i._listeners.push(t):i._listeners=[t])};n.forEach((function(e){o=[this._registered_listener.keyDown],e.split("+").forEach((function(e,t,r){var n=o,s=h._PRIVATE_METHODS.match_keys(e),a=r.length===t+1;o=[];var c=n,l=Array.isArray(c),u=0;for(c=l?c:c[Symbol.iterator]();;){var p;if(l){if(u>=c.length)break;p=c[u++]}else{if((u=c.next()).done)break;p=u.value}var f=p,_=s,d=Array.isArray(_),v=0;for(_=d?_:_[Symbol.iterator]();;){var y;if(d){if(v>=_.length)break;y=_[v++]}else{if((v=_.next()).done)break;y=v.value}i(f,y,a)}}}),this)}),this)},keyUp:function(e,t,r){h._PRIVATE_METHODS.update_key_listener(this._registered_listener.keyUp,e,t,r)},keyPress:function(e,t,r){h._PRIVATE_METHODS.update_key_listener(this._registered_listener.keyPress,e,t,r)}};var h=function(e){function t(e,r,o){var n;return l(this,t),(n=s(this,a(t).call(this,e,o)))._mesh_value=4*(window.devicePixelRatio||1),n._process_status=0,n._process_values={kd_tasks:[]},n.cursorDown=function(e){var r,o=n._points;if(n._identifiers[0]!==t.MOUSE_EVENT_ID)if(e.changedTouches&&o.length<n._max_points){var i=e.changedTouches,s=Array.isArray(i),a=0;for(i=s?i:i[Symbol.iterator]();;){var c;if(s){if(a>=i.length)break;c=i[a++]}else{if((a=i.next()).done)break;c=a.value}var l=c;if(-1===n._identifiers.indexOf(l.identifier)){r=l;break}}}else 0===o.length&&Math.pow(2,e.button)&n._bm&&(r=e);if(r){var u=t.CURSOR_EVENT_HANDLES.length;if(0===o.length){var p=n._registered_listener,f=p.dragStart&&p.dragStart(e,r)||!1;if(!0===f)return;u=0,t.CURSOR_EVENT_HANDLES.reduce((function(e,t){return p[t]&&(!1===f||~f.indexOf(t))?(u++,e[t]=p[t]):delete e[t],e}),n._activated_listener)}(u>1||u>0&&!activated_listener.dragStart)&&n._registPoint(e,r)}},n._move=function(e,t,r){var o=n._activated_listener,i=n._points[r];if(o.dragMove){var s=[t.pageX-i.mx,t.pageY-i.my];o.dragMove(e,s)?(i.mx=t.pageX-s[0],i.my=t.pageY-s[1]):(i.mx=t.pageX,i.my=t.pageY)}o.click&&Math.abs(t.pageX-i.dx)+Math.abs(t.pageY-i.dy)>n._mesh_value&&(o.click=!1)},n._move2=function(e,r,o){var i=t.STATES,s=n._activated_listener,a=n._process_values,c=n._points,l=c[o],u=c[1===o?0:1],p=r.pageX-l.mx,f=r.pageY-l.my;if(s.dragMove2){var _=[p/2,f/2];s.dragMove2(e,_)&&(p-=2*_[0],f-=2*_[1])}l.mx=l.mx+p,l.my=l.my+f;var h=(l.mx+u.mx)/2,d=(l.my+u.my)/2;if(s.pinch){var v=Math.sqrt(Math.pow(l.mx-u.mx,2)+Math.pow(l.my-u.my,2));n._process_status&i.IS_PINCH?s.pinch(e,-(a.sd-(a.sd=v))):Math.abs(v-a.sd)>n._mesh_value&&(n._process_status|=i.IS_PINCH,s.pinch(e,-(a.sd-(a.sd=v)),[h,d]))}if(s.rotate){var y=0===o?1:o,E=c[0].mx-c[y].mx,m=c[0].my-c[y].my,g=Math.atan2(m,E);g*a.ra<=0&&(a.ra=-a.ra),n._process_status&i.IS_ROTATE?(s.rotate(e,g-a.ra),a.ra=g):Math.abs(g-a.ra)>.01*Math.PI&&(n._process_status|=i.IS_ROTATE,s.rotate(e,g-a.ra,[h,d]),a.ra=g)}},n.cursorMove=function(e){n.eventDispenser(e,n._points.length<2?n._move:n._move2)},n._leave=function(e,r,o){var s;n._identifiers.splice(o,1),n._points.splice(o,1);var a=t.STATES,c=n._identifiers.length,l=n._activated_listener;switch(!0){case c<1:n.setListener((i(s={},a.MOUSE_DOWN,!0),i(s,a.MOUSE_MOVE,!1),i(s,a.MOUSE_UP,!1),i(s,a.TOUCH_MOVE,!1),i(s,a.TOUCH_END,!1),i(s,a.TOUCH_CANCEL,!1),s)),n._process_status=0,l.dragEnd&&l.dragEnd(e,r),l.click&&l.click(e,r);break;case c<n._max_points:if(n._process_status=a.IS_DRAG,e.targetTouches&&e.targetTouches.length>=n._max_points){var u=e.targetTouches,p=Array.isArray(u),f=0;for(u=p?u:u[Symbol.iterator]();;){var _;if(p){if(f>=u.length)break;_=u[f++]}else{if((f=u.next()).done)break;_=f.value}var h=_;if(-1===n._identifiers.indexOf(h.identifier)){n._registPoint(e,h);break}}}}},n.cursorUp=function(e){n.eventDispenser(e,n._leave)},n.keyDown=function(e){var r=n._process_values.kd_tasks;function o(t){if(t){for(var o=t._listeners?t._listeners.length:0,n=0;n<o;n++)if(!0===t._listeners[n](e,t._path))return!0;t._reference>o&&-1===r.indexOf(t)&&r.push(t)}}var i=t._PRIVATE_METHODS.get_keys(e);if(!r.some((function(e){return i.some((function(t){return o(e[t])}))}))){var s=i,a=Array.isArray(s),c=0;for(s=a?s:s[Symbol.iterator]();;){var l;if(a){if(c>=s.length)break;l=s[c++]}else{if((c=s.next()).done)break;l=c.value}var u=l;if(o(n._registered_listener.keyDown[u]))break}}},n.keyUp=function(e){for(var r=t._PRIVATE_METHODS.get_keys(e),o=n._process_values.kd_tasks,i=function(e){r.some((function(t){return-1!==o[e]._parts.indexOf(t)}))&&o.splice(e--,1),s=e},s=0;s<o.length;s++)i(s);var a=n._registered_listener.keyUp,c=r,l=Array.isArray(c),u=0;for(c=l?c:c[Symbol.iterator]();;){var p;if(l){if(u>=c.length)break;p=c[u++]}else{if((u=c.next()).done)break;p=u.value}var f=p;a[f]&&a[f].some((function(t){return t(e)}))}},n.keyPress=function(e){var r=t._PRIVATE_METHODS.get_keys(e),o=n._registered_listener.keyPress,i=r,s=Array.isArray(i),a=0;for(i=s?i:i[Symbol.iterator]();;){var c;if(s){if(a>=i.length)break;c=i[a++]}else{if((a=i.next()).done)break;c=a.value}var l=c;o[l]&&o[l].some((function(t){return t(e)}))}},n.registListener(r),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,e),p(t,[{key:"on",value:function(e,t){return this.updateListener(i({},e,t))}},{key:"off",value:function(e,t){return this.updateListener(i({},e,t),!0)}},{key:"activate",value:function(){this.updateListener()}},{key:"disable",value:function(){var e=this;this.setListener(Object.keys(this._listener_status).reduce((function(t,r){return e._listener_status[r]&&(t[r]=!1),t}),{}))}},{key:"updateListener",value:function(e,r){var o,n=this._registered_listener,s=t.STATES;if(e)for(var a in e)for(var c in t.PATTERN_MAP)t.PATTERN_MAP[c].test(a)&&(t._LISTENER_PREPROCESSOR[c]?e[a]&&t._LISTENER_PREPROCESSOR[c].call(this,a,e[a],r):n[c]=r?null:e[a]);this._max_points=n.pinch||n.rotate||n.dragMove2?2:1;var l=!!(n.dragStart||n.dragMove||n.dragMove2||n.dragEnd||n.click||n.pinch||n.rotate);return this.setListener((i(o={},s.MOUSE_DOWN,l),i(o,s.TOUCH_START,l),i(o,s.KEY_DOWN,n.keyDown._reference>0),i(o,s.KEY_UP,n.keyDown._reference>0||n.keyUp._reference>0),i(o,s.KEY_PRESS,n.keyPress._reference>0),o)),this}},{key:"_registPoint",value:function(e,r){var o,n=t.STATES,s=this._points,a=this._activated_listener;switch(s.push({dx:r.pageX,dy:r.pageY,mx:r.pageX,my:r.pageY}),this._identifiers.push(isNaN(r.identifier)?t.MOUSE_EVENT_ID:r.identifier),s.length){case 1:this._process_status=n.IS_DRAG;var c=this._is_mouse_event;this.setListener((i(o={},n.MOUSE_DOWN,c),i(o,n.MOUSE_MOVE,c),i(o,n.MOUSE_UP,c),i(o,n.TOUCH_MOVE,!c),i(o,n.TOUCH_END,!c),i(o,n.TOUCH_CANCEL,!c),o));break;case 2:this._process_values.sd=Math.sqrt(Math.pow(s[0].mx-s[1].mx,2)+Math.pow(s[0].my-s[1].my,2)),this._process_values.ra=Math.atan2(s[0].my-s[1].my,s[0].mx-s[1].mx),a.click&&(a.click=!1)}}},{key:"registListener",value:function(e){this.updateListener(e)}},{key:"removeListener",value:function(e){e&&this.updateListener(e,!0)}}]),t}(_);try{window.InputListener=h}catch(e){}e.exports=h}])}])}));