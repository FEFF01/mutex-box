!function(o,r){if("object"==typeof exports&&"object"==typeof module)module.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{var t=r();for(var n in t)("object"==typeof exports?exports:o)[n]=t[n]}}(this,(function(){return function(o){var r={};function t(n){if(r[n])return r[n].exports;var e=r[n]={i:n,l:!1,exports:{}};return o[n].call(e.exports,e,e.exports,t),e.l=!0,e.exports}return t.m=o,t.c=r,t.d=function(o,r,n){t.o(o,r)||Object.defineProperty(o,r,{enumerable:!0,get:n})},t.r=function(o){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},t.t=function(o,r){if(1&r&&(o=t(o)),8&r)return o;if(4&r&&"object"==typeof o&&o&&o.__esModule)return o;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:o}),2&r&&"string"!=typeof o)for(var e in o)t.d(n,e,function(r){return o[r]}.bind(null,e));return n},t.n=function(o){var r=o&&o.__esModule?function(){return o.default}:function(){return o};return t.d(r,"a",r),r},t.o=function(o,r){return Object.prototype.hasOwnProperty.call(o,r)},t.p="",t(t.s=1)}([,function(o,r,t){"use strict";var n,e=this&&this.__assign||function(){return(e=Object.assign||function(o){for(var r,t=1,n=arguments.length;t<n;t++)for(var e in r=arguments[t])Object.prototype.hasOwnProperty.call(r,e)&&(o[e]=r[e]);return o}).apply(this,arguments)};Object.defineProperty(r,"__esModule",{value:!0}),function(o){o[o.USE_CHECK=1]="USE_CHECK",o[o.FILL_EACHMODEL=16]="FILL_EACHMODEL",o[o.USE_OFFSET=256]="USE_OFFSET",o[o.USE_EACHOFFSET=4096]="USE_EACHOFFSET"}(n||(n={}));var s=function(){function o(r,t){void 0===r&&(r=[]),void 0===t&&(t={}),this.options=t,this.model_map=new Array,this.model_list=new Array,this.options.ncols>0||(this.options.ncols=r.reduce((function(o,r){return Math.max(o,(r.col||0)+(r.colspan||1))}),1));var n=this._fill(r,o.FLAGS.USE_CHECK|o.FLAGS.FILL_EACHMODEL);this.append(n)}return Object.defineProperty(o.prototype,"ncols",{get:function(){return this.options.ncols},set:function(o){this.setNCols(o)},enumerable:!0,configurable:!0}),o.prototype.setNCols=function(r,t){if(r!==this.options.ncols){this.model_map.splice(0,this.model_map.length);var n=this.model_list.splice(0,this.model_list.length);if(t&&1!==t)for(var e=r-this.options.ncols,s=0,l=n;s<l.length;s++){l[s].col+=e}this.options.ncols=r;var a=this._fill(n,o.FLAGS.USE_CHECK|o.FLAGS.FILL_EACHMODEL);this.append(a)}},o.prototype.fill=function(r){r instanceof Array||(r=[r]),this._fill(r,o.FLAGS.FILL_EACHMODEL)},o.prototype.clear=function(o){var r=this.model_list.indexOf(o),t=0;for(~r&&this.model_list.splice(r,1);~(r=this.model_map.indexOf(o));)t++,this.model_map[r]=void 0;return t},o.prototype.remove=function(o){o instanceof Array||(o=[o]),this._fill(o)},o.prototype.move=function(r,t,n){return void 0===n&&(n=0),r instanceof Array||(r=[r]),this.remove(r),this._fill(r,n|o.FLAGS.FILL_EACHMODEL|o.FLAGS.USE_OFFSET,t)},o.prototype.getModel=function(o,r){if(o>=0&&r>=0&&o<this.ncols)return this.model_map[o+r*this.ncols]},o.prototype.format=function(o,r,t){return void 0===r&&(r=o.col),void 0===t&&(t=o.row),o.col=Math.round(Math.max(Math.min(r,this.ncols-o.colspan),0)),o.row=Math.round(Math.max(t,0)),o},o.prototype.trim=function(){for(var o=Math.ceil(this.model_map.length/this.ncols),r=[],t=1;t<o;t++)for(var n=0;n<this.ncols;n++){var e=t*this.ncols+n,s=this.model_map[e];if(s&&s.row===t){var l=this._pathTest([s],[0,-t-1],s);l>0&&(r.push(s),this.move([s],[0,-l])),n+=s.colspan-1}}return r},o.prototype.append=function(r){r instanceof Array||(r=[r]);for(var t=0,n=r;t<n.length;t++){var e=n[t];e.colspan>this.ncols&&(e.colspan=this.ncols);for(var s=Math.ceil(this.model_map.length/this.ncols),l=0,a=0,i={col:0,row:s,colspan:e.colspan,rowspan:e.rowspan},c=0,p=this.ncols-e.colspan;c<=p;c++){i.col=c;var f=this._pathTest([i],[0,-s-1],i);l<f&&(l=f,a=c)}e.col=a,e.row=s-l,this._fill([e],o.FLAGS.FILL_EACHMODEL)}},o.prototype.alloc=function(r,t,n,s){void 0===t&&(t=this.format({col:r.col,row:r.row,colspan:r.colspan,rowspan:r.rowspan})),void 0===n&&(n=this.cover(t));var l=n.slice();if(0===n.length)return l;if(s||(s=this.calcWrap(n)),s.colspan+s.rowspan>1.6*(t.colspan+t.rowspan)||!this._compress(t,n,s,r)){n.sort((function(o,r){return o.row-r.row}));for(var a=e({},t),i=0;i<n.length;i++){var c=n[i];this._compress(a,[c],c,void 0,!1)?n.splice(i--,1):(a.col>c.col&&(a.colspan+=a.col-c.col,a.col=c.col),a.col+a.colspan<c.col+c.colspan&&(a.colspan=c.col+c.colspan-a.col))}if(0===n.length)return l;var p=[],f=[];s=this.calcWrap(n);for(var h=t.colspan-Math.max(s.col-t.col,0)-Math.max(t.col+t.colspan-s.colspan-s.col,0),u=[{col:Math.max(t.col,s.col),row:t.row,colspan:h,rowspan:0}],v={},d=[new Array(h).fill(t.rowspan)];u.length;){var w=[],_={},m=[];for(var E in v)v[E].sort((function(o,r){return o.row-r.row}));for(i=0;i<u.length;i++){for(var y=u[i],O=d[i],L=(A=y.col)+y.colspan;A<L;A++){if(j=v[A]){for(var F=0,S=0;S<j.length-1;S++){var M=j[S];if(!(M.row<y.row))break;F+=j[S+1].row-(M.row+M.rowspan)}O[A-y.col]-=F}}if((b=Math.max.apply(Number,O))>0)if(d[i]=b,-1===(S=p.indexOf(y)))S=p.length,p.push(y),f.push(b);else{if(f[S]>=b)continue;f[S]=b}else u.splice(i,1),d.splice(i,1),i--}for(S=0;S<u.length;S++){y=u[S];var b=d[S];var A=y.col;o:for(L=A+y.colspan;A<L;A++)for(var g=y.row+y.rowspan,C=g+b;g<C;g++){var x=this.model_map[A+g*this.ncols];if(x){var H=w.indexOf(x),U=(O=void 0,C-g+Math.max(y.row-x.row,0));if(-1===H){var j,T=p.indexOf(x);if(T>=0&&f[T]>=U)continue o;w.push(x),m.push(O=new Array(x.colspan).fill(0)),(j=_[A]||(_[A]=[])).push({row:x.row,rowspan:x.rowspan})}else O=m[H];O[A-x.col]=Math.max(O[A-x.col],U);break}}}u=w,v=_,d=m}p.splice(0,1),f.splice(0,1),this.move(p,f.map((function(o){return[0,o]})),o.FLAGS.USE_EACHOFFSET),l=l.concat(p)}return l},o.prototype.cover=function(o){for(var r=[],t=o.col,n=o.row,e=0;e<o.rowspan;e++)for(var s=0;s<o.colspan;s++){var l=this.model_map[s+t+(e+n)*this.ncols];if(void 0!==l){~r.indexOf(l)||r.push(l);var a=l.colspan+l.col-1;s+t<a&&(s=a-t)}}return r},o.prototype.calcWrap=function(o){for(var r={col:o[0].col,row:o[0].row,colspan:o[0].colspan,rowspan:o[0].rowspan},t=1;t<o.length;t++){var n=o[t];r.col>n.col&&(r.colspan+=r.col-n.col,r.col=n.col),r.row>n.row&&(r.rowspan+=r.row-n.row,r.row=n.row),r.colspan+r.col<n.col+n.colspan&&(r.colspan+=n.col+n.colspan-r.col-r.colspan),r.rowspan+r.row<n.row+n.rowspan&&(r.rowspan+=n.row+n.rowspan-r.row-r.rowspan)}return r},o.prototype.calcOffset=function(o,r){return{l:o.col-(r.col+r.colspan),r:o.col+o.colspan-r.col,t:o.row-(r.row+r.rowspan),b:o.row+o.rowspan-r.row}},o.prototype._fill=function(r,t,n){void 0===t&&(t=0);var e=o.FLAGS,s=t&e.USE_CHECK?[]:void 0,l=this.model_map,a=this.model_list,i=this.ncols;o:for(var c=0;c<r.length;c++){var p=r[c];if(t&e.USE_CHECK&&(isFinite(p.colspan)||(p.colspan=1),isFinite(p.rowspan)||(p.rowspan=1),isNaN(p.col+p.row)||p.col<0||p.col+p.colspan>i))s.push(p);else{var f=a.indexOf(p);if(t&e.FILL_EACHMODEL){if(-1!==f)continue;a.push(p)}else f>=0&&a.splice(f,1);t&e.USE_EACHOFFSET?(p.col+=n[c][0],p.row+=n[c][1]):t&e.USE_OFFSET&&(p.col+=n[0],p.row+=n[1]);for(var h=p.col,u=p.row,v=p.colspan,d=p.rowspan,w=0;w<d;w++)for(var _=0;_<v;_++){var m=_+h+(w+u)*i;if(t&e.USE_CHECK&&void 0!==l[m]){do{for(;_--;)l[_+h+(w+u)*i]=void 0;_=v}while(w--);t&e.FILL_EACHMODEL&&a.pop(),s.push(p);continue o}l[m]=t&e.FILL_EACHMODEL?p:n}}}return s},o.prototype._pathTest=function(o,r,t){void 0===t&&(t=this.calcWrap(o));for(var n=0|r[0],e=0|r[1],s=0,l=0,a=0,i=n&&n/Math.abs(n),c=e&&e/Math.abs(e);s!==n||l!==e;){if(s!==n?s+=i:l+=c,t.col+s<0||t.col+s+t.colspan>this.ncols||t.row+l<0)return a;for(var p=0,f=o;p<f.length;p++)for(var h=f[p],u=h.row,v=u+h.rowspan;u<v;u++)for(var d=h.col,w=d+h.colspan;d<w;d++){var _=d+s+(u+l)*this.ncols;if(this.model_map[_]&&-1===o.indexOf(this.model_map[_]))return a}a+=1}return!0},o.prototype._compress=function(o,r,t,n,e){void 0===r&&(r=this.cover(o)),void 0===t&&(t=this.calcWrap(r)),void 0===e&&(e=!0);var s=t.colspan/t.rowspan,l=o.rowspan/o.colspan,a=(s+l)/4;s=a+s/2,l=a+l/2;var i=this.calcOffset(o,t),c=n?this.calcOffset(n,t):i,p=[Math.abs(l*c.l),[i.l,0]],f=[Math.abs(l*c.r),[i.r,0],p];p.push(f),f.push(p);var h,u=[Math.abs(s*c.t),[0,i.t]];e&&(h=[Math.abs(s*c.b),[0,i.b]],u.push(h),h.push(u));for(var v=(e?[p,f,u,h]:[p,f,u]).sort((function(o,r){return o[0]-r[0]})),d=0;d<v.length;d++){var w=v.lastIndexOf(v[d][2]);if(w>d&&(v.splice(w,1),v.splice(d+1,0,v[d][2])),!0===this._pathTest(r,v[d][1],t))return this.move(r,v[d][1]),!0}return!1},o.FLAGS=n,o}();r.default=s}])}));
//# sourceMappingURL=mutex_model.js.map