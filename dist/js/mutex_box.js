!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([,function(e,t,r){"use strict";function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.reduce((function(e,t){return Math.max(e,(t.col||0)+(t.colspan||1))}),1);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.model_map=new Array,this.model_list=new Array,this._ncols=null,this.ncols=null,this.model_list=this.model_list.concat(t),this.ncols=r}var t,r,a;return t=e,(r=[{key:"fill",value:function(t){t instanceof Array||(t=[t]),this._fill(t,e.STATES.FILL_EACHMODEL)}},{key:"clear",value:function(e){var t=this.model_list.indexOf(e),r=0;for(~t||this.model_list.splice(t,1);~(t=this.model_map.indexOf(e));)r++,this.model_map[t]=void 0;return r}},{key:"remove",value:function(e){e instanceof Array||(e=[e]),this._fill(e)}},{key:"move",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t instanceof Array||(t=[t]),this.remove(t),this._fill(t,n|e.STATES.FILL_EACHMODEL|e.STATES.USE_OFFSET,r)}},{key:"getModel",value:function(e,t){if(e>=0&&t>=0&&e<this.ncols)return this.model_map[e+t*this.ncols]}},{key:"format",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.col,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.row;return e.col=Math.round(Math.max(Math.min(t,this.ncols-e.colspan),0)),e.row=Math.round(Math.max(r,0)),e}},{key:"trim",value:function(){for(var e=Math.ceil(this.model_map.length/this.ncols),t=[],r=1;r<e;r++)for(var n=0;n<this.ncols;n++){var o=r*this.ncols+n,i=this.model_map[o];if(i&&i.row===r){var a=this._pathTest([i],[0,-r-1],i);a>0&&(t.push(i),this.move([i],[0,-a])),n+=i.colspan-1}}return t}},{key:"append",value:function(t){t instanceof Array||(t=[t]);var r=t,n=Array.isArray(r),o=0;for(r=n?r:r[Symbol.iterator]();;){var i;if(n){if(o>=r.length)break;i=r[o++]}else{if((o=r.next()).done)break;i=o.value}var a=i;a.colspan>this.ncols&&(a.colspan=this.ncols);for(var s=Math.ceil(this.model_map.length/this.ncols),l=0,c=0,u={col:0,row:s,colspan:a.colspan,rowspan:a.rowspan},f=0,p=this.ncols-a.colspan;f<=p;f++){u.col=f;var _=this._pathTest([u],[0,-s-1],u);l<_&&(l=_,c=f)}a.col=c,a.row=s-l,this._fill([a],e.STATES.FILL_EACHMODEL)}}},{key:"alloc",value:function(t,r){var i=this.format(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t)),a=this.cover(i),s=a.slice();if(0===a.length)return s;var l=this.calcWrap(a);if(r&&i.col===l.col&&i.row===l.row&&r.colspan===l.colspan&&r.rowspan===l.rowspan&&(Math.abs(t.col-l.col)+Math.abs(t.row-l.row))/(r.colspan+r.rowspan)<.06&&Math.abs(r.col-l.col)/r.colspan+Math.abs(r.row-l.row)/r.rowspan>1)this.move(a,[r.col-l.col,r.row-l.row]);else if(l.colspan+l.rowspan>2*(i.colspan+i.rowspan)||!this._compress(i,a,l,t)){for(var c=0;c<a.length;c++)this._compress(i,[a[c]],a[c],void 0,!1)&&a.splice(c--,1);if(0===a.length)return s;var u=[],f=[];l=this.calcWrap(a);for(var p=i.colspan-Math.max(l.col-i.col,0)-Math.max(i.col+i.colspan-l.colspan-l.col,0),_=[{col:Math.max(i.col,l.col),row:i.row,colspan:p,rowspan:0}],h={},v=[new Array(p).fill(i.rowspan)];_.length;){var d={},y=[],m=[];for(var g in h)h[g].sort((function(e,t){return e.row-t.row}));for(var w=0;w<_.length;w++){for(var b=_[w],O=v[w],E=b.col,S=E+b.colspan;E<S;E++){var k=h[E];if(k){for(var M=0,T=0;T<k.length-1;T++){var P=k[T];if(!(P.row<b.row))break;M+=k[T+1].row-(P.row+P.rowspan)}O[E-b.col]-=M}}var A=Math.max.apply(Number,O);if(A>0){v[w]=A;var x=u.indexOf(b);if(-1===x)x=u.length,u.push(b),f.push(A);else{if(f[x]>=A)continue;f[x]=A}}else _.splice(w,1),v.splice(w,1),w--}for(var U=0;U<_.length;U++){var C=_[U],D=v[U];e:for(var L=C.col,j=L+C.colspan;L<j;L++)for(var N=C.row+C.rowspan,R=N+D;N<R;N++){var H=this.model_map[L+N*this.ncols];if(H){var I=y.indexOf(H),V=void 0,F=R-N+Math.max(C.row-H.row,0);if(-1===I){var Y=u.indexOf(H);if(Y>=0&&f[Y]>=F)continue e;y.push(H),m.push(V=new Array(H.colspan).fill(0)),(d[L]||(d[L]=[])).push({row:H.row,rowspan:H.rowspan})}else V=m[I];V[L-H.col]=Math.max(V[L-H.col],F);break}}}_=y,h=d,v=m}u.splice(0,1),f.splice(0,1),this.move(u,f.map((function(e){return[0,e]})),e.STATES.USE_EACHOFFSET),s=s.concat(u)}return s}},{key:"cover",value:function(e){for(var t=[],r=e.col,n=e.row,o=0;o<e.rowspan;o++)for(var i=0;i<e.colspan;i++){var a=this.model_map[i+r+(o+n)*this.ncols];if(void 0!==a){~t.indexOf(a)||t.push(a);var s=a.colspan+a.col-1;i+r<s&&(i=s-r)}}return t}},{key:"calcWrap",value:function(e){for(var t={col:e[0].col,row:e[0].row,colspan:e[0].colspan,rowspan:e[0].rowspan},r=1;r<e.length;r++){var n=e[r];t.col>n.col&&(t.colspan+=t.col-n.col,t.col=n.col),t.row>n.row&&(t.rowspan+=t.row-n.row,t.row=n.row),t.colspan+t.col<n.col+n.colspan&&(t.colspan+=n.col+n.colspan-t.col-t.colspan),t.rowspan+t.row<n.row+n.rowspan&&(t.rowspan+=n.row+n.rowspan-t.row-t.rowspan)}return t}},{key:"calcOffset",value:function(e,t){return{l:e.col-(t.col+t.colspan),r:e.col+e.colspan-t.col,t:e.row-(t.row+t.rowspan),b:e.row+e.rowspan-t.row}}},{key:"_fill",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,o=e.STATES,i=r&o.USE_CHECK?[]:void 0,a=this.model_map,s=this.model_list,l=this.ncols;e:for(var c=0;c<t.length;c++){var u=t[c];if(r&o.USE_CHECK&&(isFinite(u.colspan)||(u.colspan=1),isFinite(u.rowspan)||(u.rowspan=1),isNaN(u.col+u.row)||u.col+u.colspan>l))i.push(u);else{var f=s.indexOf(u);if(r&o.FILL_EACHMODEL){if(-1!==f)continue;s.push(u)}else f>=0&&s.splice(f,1);r&o.USE_EACHOFFSET?(u.col+=n[c][0],u.row+=n[c][1]):r&o.USE_OFFSET&&(u.col+=n[0],u.row+=n[1]);for(var p=u.col,_=u.row,h=u.colspan,v=u.rowspan,d=0;d<v;d++)for(var y=0;y<h;y++){var m=y+p+(d+_)*l;if(r&o.USE_CHECK&&void 0!==a[m]){do{for(;y--;)a[y+p+(d+_)*l]=void 0;y=h}while(d--);r&o.FILL_EACHMODEL&&s.pop(),i.push(u);continue e}a[m]=r&o.FILL_EACHMODEL?u:n}}}return i}},{key:"_pathTest",value:function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.calcWrap(e),n=0|t[0],o=0|t[1],i=0,a=0,s=0,l=n&&n/Math.abs(n),c=o&&o/Math.abs(o);i!==n||a!==o;){if(i!==n?i+=l:a+=c,r.col+i<0||r.col+i+r.colspan>this.ncols||r.row+a<0)return s;var u=e,f=Array.isArray(u),p=0;for(u=f?u:u[Symbol.iterator]();;){var _;if(f){if(p>=u.length)break;_=u[p++]}else{if((p=u.next()).done)break;_=p.value}for(var h=_,v=h.row,d=v+h.rowspan;v<d;v++)for(var y=h.col,m=y+h.colspan;y<m;y++){var g=y+i+(v+a)*this.ncols;if(this.model_map[g]&&-1===e.indexOf(this.model_map[g]))return s}}s+=1}return!0}},{key:"_compress",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.cover(e),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.calcWrap(crossed_models),n=arguments.length>3?arguments[3]:void 0,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=e.rowspan/e.colspan,a=r.colspan/r.rowspan,s=this.calcOffset(e,r),l=n?this.calcOffset(n,r):s,c=[Math.abs(i*l.l),[s.l,0]],u=[Math.abs(i*l.r),[s.r,0]];c.push(u),u.push(c);var f,p=[Math.abs(a*l.t),[0,s.t]];o&&(f=[Math.abs(a*l.b),[0,s.b]],p.push(f),f.push(p));for(var _=(o?[c,u,p,f]:[c,u,p]).sort((function(e,t){return e[0]-t[0]})),h=0;h<_.length;h++){var v=_.lastIndexOf(_[h][2]);if(v>h&&(_.splice(v,1),_.splice(h+1,0,_[h][2])),!0===this._pathTest(t,_[h][1],r))return this.move(t,_[h][1]),!0}}},{key:"ncols",get:function(){return this._ncols},set:function(t){if(t!==this._ncols){this._ncols=t,this.model_map.splice(0,this.model_map.length);var r=this.model_list.splice(0,this.model_list.length),n=this._fill(r,e.STATES.USE_CHECK|e.STATES.FILL_EACHMODEL);this.append(n)}}}])&&i(t.prototype,r),a&&i(t,a),e}();a.STATES={USE_CHECK:1,FILL_EACHMODEL:16,USE_OFFSET:256,USE_EACHOFFSET:4096},e.exports=a},,function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(e,t,r){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}r(4);var c=r(1),u=function(e){function t(e,r){var n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=i(this,s(t).call(this,r,o.ncols))).vessel=null,n.inputListener=null,n.space={top:0,right:0,bottom:0,left:0},n.capture={top:0,right:0,bottom:0,left:0},n.target_model=null,n._longtap_timeout=null,n._client_width=0,n.dragStart=function(e,t){var r=n.vessel.getBoundingClientRect(),o=t.clientX-r.left,i=t.clientY-r.top;return n.target_model=n._get_model(o,i,e,t),!n.target_model||(e.preventDefault(),n.target_model.dragging=!0,void n.remove(n.target_model))},n.dragMove=function(e,t){n.target_model.left+=t[0],n.target_model.top+=t[1],n._longtap_timeout&&(window.clearTimeout(n._longtap_timeout),n._longtap_timeout=null),n._longtap_timeout=window.setTimeout(n._put_model,300)},n.dragEnd=function(e){n._longtap_timeout&&window.clearTimeout(n._longtap_timeout),n._put_model(!0)},n._window_resize=function(e){n._client_width!==n.vessel.clientWidth&&(n._client_width=n.vessel.clientWidth,n._update(n.model_list))},n._put_model=function(e){n._longtap_timeout=null;var t=n.target_model,r=n.cellSize,o=t.left/r,i=t.top/r;n.alloc({col:o,row:i,colspan:t.colspan,rowspan:t.rowspan},t),!0===e&&(t.dragging=!1,n.format(t,o,i),n.fill(t),n._update([t]),n.target_model=null)},n.vessel=e,n.inputListener=new InputListener(e,{dragStart:n.dragStart,dragMove:n.dragMove,dragEnd:n.dragEnd}),n.resize(o),n.activate(),n}var r,n,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,e),r=t,(n=[{key:"disable",value:function(){window.removeEventListener("resize",this._window_resize),this.inputListener.disable()}},{key:"activate",value:function(){this._window_resize(),window.addEventListener("resize",this._window_resize),this.inputListener.activate()}},{key:"trim",value:function(){this._update(a(s(t.prototype),"trim",this).call(this))}},{key:"alloc",value:function(e,r){this._update(a(s(t.prototype),"alloc",this).call(this,e,r))}},{key:"remove",value:function(e){a(s(t.prototype),"remove",this).call(this,e)}},{key:"add",value:function(e){e instanceof Array||(e=[e]);var t=e,r=Array.isArray(t),n=0;for(t=r?t:t[Symbol.iterator]();;){var o;if(r){if(n>=t.length)break;o=t[n++]}else{if((n=t.next()).done)break;o=n.value}var i=o;i.col>=0&&i.col+i.colspan<=this.ncols&&i.row>=0?(this.alloc(i),this.fill(i)):this.append(i)}this._update(e)}},{key:"resize",value:function(e){isNaN(e)?e instanceof Object&&(e.space&&(this.space=e.space),e.capture&&(this.capture=e.capture),isNaN(e.ncols)||(this.ncols=e.ncols)):this.ncols=e,this._client_width=this.vessel.clientWidth,this.update()}},{key:"update",value:function(e,t){if(e){if(t instanceof Object)for(var r in t)e[r]=t[r];this.clear(e),this.alloc(e),this.fill(e),this._update([e])}else this._update(this.model_list)}},{key:"_update",value:function(e){var t,r,n,o,i=this.cellSize,a=e,s=Array.isArray(a),l=0;for(a=s?a:a[Symbol.iterator]();;){var c;if(s){if(l>=a.length)break;c=a[l++]}else{if((l=a.next()).done)break;c=l.value}var u=c,f=u.space||this.space,p=f.left,_=void 0===p?0:p,h=f.right,v=void 0===h?0:h,d=f.top,y=void 0===d?0:d,m=f.bottom,g=void 0===m?0:m;t=i*u.col+_,r=i*u.row+y,n=i*u.colspan-_-v,o=i*u.rowspan-y-g,t!==u.left&&(u.left=t),r!==u.top&&(u.top=r),n!==u.width&&(u.width=n),o!==u.height&&(u.height=o)}}},{key:"_get_model",value:function(e,t,r,n){var o=this.cellSize,i=this.getModel(e/o|0,t/o|0);if(i){var a=i.capture||this.capture;if(a instanceof Function){var s=a(r,n,i);return!0===s?i:s}var l=function(e,t,r){return r>=0?t<e-r:t>=e+r&&t<e},c=i.space||this.space,u=c.top,f=void 0===u?0:u,p=c.right,_=void 0===p?0:p,h=c.bottom,v=void 0===h?0:h,d=c.left,y=void 0===d?0:d,m=a.top,g=void 0===m?0:m,w=a.right,b=void 0===w?0:w,O=a.bottom,E=void 0===O?0:O,S=a.left,k=void 0===S?0:S,M=i.col*o+y,T=i.row*o+f,P=i.colspan*o-_-y,A=i.rowspan*o-f-v,x=e-M-P/2,U=t-T-A/2,C=Math.sqrt(Math.pow(x,2)+Math.pow(U,2)),D=Math.atan2(U,x),L=2*Math.atan(P/A),j=(Math.PI-L)/2,N=Math.PI/2;switch(!0){case D<-j&&D>-L-j:return l(A/2,C*Math.cos(N+D),g)&&i;case Math.abs(D)<=j:return l(P/2,C*Math.cos(D),b)&&i;case D>j&&D<j+L:return l(A/2,Math.abs(C*Math.cos(N+D)),E)&&i;case Math.abs(D)>=L+j:return l(P/2,Math.abs(C*Math.cos(D)),k)&&i}}}},{key:"cellSize",get:function(){return this._client_width/this.ncols}}])&&o(r.prototype,n),c&&o(r,c),t}(c);u.MutexModel=c;try{window.MutexBox=u}catch(e){}e.exports=u},function(e,t,r){window,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),e}var p={rotate:/^rotate$/,pinch:/^pinch$/,dragMove2:/^dragMove2$/,dragStart:/^dragStart$/,dragMove:/^dragMove$/,dragEnd:/^dragEnd$/,click:/^click$/},_=function(){function e(t,r){c(this,e),this._activated_listener={},this._registered_listener={rotate:null,pinch:null,dragMove:null,dragStart:null,dragEnd:null,dragMove2:null,click:null,keyDown:{_parts:[],_reference:0},keyUp:{_reference:0},keyPress:{_reference:0}},this._bm=1,this.target=null,this._listener_options=void 0,this._listener_status={},this._points=[],this._identifiers=[],this.target=t,this._listener_options=r}return f(e,[{key:"setListener",value:function(e){for(var t in e)if(!this._listener_status[t]!=!e[t]){var r=h.EVENT_CONFIG[t],n=r[0],o=r[1],i=r[2]||this.target;e[t]?i.addEventListener(n,this[o],this._listener_options):i.removeEventListener(n,this[o],this._listener_options),this._listener_status[t]=!!e[t]}}},{key:"eventDispenser",value:function(e,t){if(this._identifiers[0]===h.MOUSE_EVENT_ID)Math.pow(2,e.button)&this._bm&&t(e,e,0);else if(e.changedTouches)for(var r=0;r<e.changedTouches.length;r++){var n=this._identifiers.indexOf(e.changedTouches[r].identifier);-1!==n&&t(e,e.changedTouches[r],n)}}},{key:"_is_mouse_event",get:function(){return this._identifiers[0]===h.MOUSE_EVENT_ID}}]),e}();_.EVENT_CONFIG={MOUSE_DOWN:["mousedown","cursorDown"],MOUSE_MOVE:["mousemove","cursorMove",window],MOUSE_UP:["mouseup","cursorUp",window],TOUCH_START:["touchstart","cursorDown"],TOUCH_MOVE:["touchmove","cursorMove",window],TOUCH_END:["touchend","cursorUp",window],TOUCH_CANCEL:["touchcancel","cursorUp",window],KEY_DOWN:["keydown","keyDown"],KEY_UP:["keyup","keyUp"],KEY_PRESS:["keypress","keyPress"]},_.CURSOR_EVENT_HANDLES=Object.keys(p),_.STATES={IS_DRAG:1,IS_ROTATE:2,IS_PINCH:4,MOUSE_DOWN:"MOUSE_DOWN",MOUSE_MOVE:"MOUSE_MOVE",MOUSE_UP:"MOUSE_UP",TOUCH_START:"TOUCH_START",TOUCH_MOVE:"TOUCH_MOVE",TOUCH_END:"TOUCH_END",TOUCH_CANCEL:"TOUCH_CANCEL",KEY_DOWN:"KEY_DOWN",KEY_UP:"KEY_UP",KEY_PRESS:"KEY_PRESS"},_.PATTERN_MAP=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},p,{},{keyDown:/^\S+_keyDown$/,keyUp:/^\S+_keyUp$/,keyPress:/^\S+_keyPress$/}),_.MOUSE_EVENT_ID=-9007199254740991,_._PRIVATE_METHODS={update_key_listener:function(e,t,r,n){h._PRIVATE_METHODS.match_keys(t,(function(t){var o=e[t];o||(o=e[t]=[]);var i=o.indexOf(r);n?i>=0&&(e._reference--,o.length>1?o.splice(i,1):delete e[t]):(e._reference++,~i||o.push(r))}))},match_keys:function(e,t){var r=e.match(/(\w+?|\ )(?=$|\||\,|\+)/g);if(r=r?r.map((function(e){return e.toLocaleLowerCase()})):[],!t)return r;var n=r,o=Array.isArray(n),i=0;for(n=o?n:n[Symbol.iterator]();;){var a;if(o){if(i>=n.length)break;a=n[i++]}else{if((i=n.next()).done)break;a=i.value}if(t(a))break}},get_keys:function(e){return e.code&&e.key!==e.code?[e.key.toLocaleLowerCase(),e.code.toLocaleLowerCase()]:[e.key.toLocaleLowerCase()]}},_._LISTENER_PREPROCESSOR={keyDown:function(e,t,r){var n,o=e.slice(0,-8).split(","),i=r?function(e,r,n){if(n){var o=e[r];if(o){var i=o._listeners.indexOf(t);-1!==i&&(o._listeners.splice(i,1),function e(t){var r=t._parent;--t._reference<=0&&r&&(delete r[t._key],e(r))}(o))}}}:function(e,r,o){var i=e[r];i||((i=e[r]={_parent:e,_key:r,_reference:0,_parts:e._parts.concat(r)})._path=i._parts.join("+"),e._reference++),n.push(i),o&&(i._reference++,i._listeners?-1===i._listeners.indexOf(t)&&i._listeners.push(t):i._listeners=[t])};o.forEach((function(e){n=[this._registered_listener.keyDown],e.split("+").forEach((function(e,t,r){var o=n,a=h._PRIVATE_METHODS.match_keys(e),s=r.length===t+1;n=[];var l=o,c=Array.isArray(l),u=0;for(l=c?l:l[Symbol.iterator]();;){var f;if(c){if(u>=l.length)break;f=l[u++]}else{if((u=l.next()).done)break;f=u.value}var p=f,_=a,v=Array.isArray(_),d=0;for(_=v?_:_[Symbol.iterator]();;){var y;if(v){if(d>=_.length)break;y=_[d++]}else{if((d=_.next()).done)break;y=d.value}i(p,y,s)}}}),this)}),this)},keyUp:function(e,t,r){h._PRIVATE_METHODS.update_key_listener(this._registered_listener.keyUp,e,t,r)},keyPress:function(e,t,r){h._PRIVATE_METHODS.update_key_listener(this._registered_listener.keyPress,e,t,r)}};var h=function(e){function t(e,r,n){var o;return c(this,t),(o=a(this,s(t).call(this,e,n)))._mesh_value=4*(window.devicePixelRatio||1),o._process_status=0,o._process_values={kd_tasks:[]},o.cursorDown=function(e){var r,n=o._points;if(o._identifiers[0]!==t.MOUSE_EVENT_ID)if(e.changedTouches&&n.length<o._max_points){var i=e.changedTouches,a=Array.isArray(i),s=0;for(i=a?i:i[Symbol.iterator]();;){var l;if(a){if(s>=i.length)break;l=i[s++]}else{if((s=i.next()).done)break;l=s.value}var c=l;if(-1===o._identifiers.indexOf(c.identifier)){r=c;break}}}else 0===n.length&&Math.pow(2,e.button)&o._bm&&(r=e);if(r){var u=t.CURSOR_EVENT_HANDLES.length;if(0===n.length){var f=o._registered_listener,p=f.dragStart&&f.dragStart(e,r)||!1;if(!0===p)return;u=0,t.CURSOR_EVENT_HANDLES.reduce((function(e,t){return f[t]&&(!1===p||~p.indexOf(t))?(u++,e[t]=f[t]):delete e[t],e}),o._activated_listener)}(u>1||u>0&&!activated_listener.dragStart)&&o._registPoint(e,r)}},o._move=function(e,t,r){var n=o._activated_listener,i=o._points[r];if(n.dragMove){var a=[t.pageX-i.mx,t.pageY-i.my];n.dragMove(e,a)?(i.mx=t.pageX-a[0],i.my=t.pageY-a[1]):(i.mx=t.pageX,i.my=t.pageY)}n.click&&Math.abs(t.pageX-i.dx)+Math.abs(t.pageY-i.dy)>o._mesh_value&&(n.click=!1)},o._move2=function(e,r,n){var i=t.STATES,a=o._activated_listener,s=o._process_values,l=o._points,c=l[n],u=l[1===n?0:1],f=r.pageX-c.mx,p=r.pageY-c.my;if(a.dragMove2){var _=[f/2,p/2];a.dragMove2(e,_)&&(f-=2*_[0],p-=2*_[1])}c.mx=c.mx+f,c.my=c.my+p;var h=(c.mx+u.mx)/2,v=(c.my+u.my)/2;if(a.pinch){var d=Math.sqrt(Math.pow(c.mx-u.mx,2)+Math.pow(c.my-u.my,2));o._process_status&i.IS_PINCH?a.pinch(e,-(s.sd-(s.sd=d))):Math.abs(d-s.sd)>o._mesh_value&&(o._process_status|=i.IS_PINCH,a.pinch(e,-(s.sd-(s.sd=d)),[h,v]))}if(a.rotate){var y=0===n?1:n,m=l[0].mx-l[y].mx,g=l[0].my-l[y].my,w=Math.atan2(g,m);w*s.ra<=0&&(s.ra=-s.ra),o._process_status&i.IS_ROTATE?(a.rotate(e,w-s.ra),s.ra=w):Math.abs(w-s.ra)>.01*Math.PI&&(o._process_status|=i.IS_ROTATE,a.rotate(e,w-s.ra,[h,v]),s.ra=w)}},o.cursorMove=function(e){o.eventDispenser(e,o._points.length<2?o._move:o._move2)},o._leave=function(e,r,n){var a;o._identifiers.splice(n,1),o._points.splice(n,1);var s=t.STATES,l=o._identifiers.length,c=o._activated_listener;switch(!0){case l<1:o.setListener((i(a={},s.MOUSE_DOWN,!0),i(a,s.MOUSE_MOVE,!1),i(a,s.MOUSE_UP,!1),i(a,s.TOUCH_MOVE,!1),i(a,s.TOUCH_END,!1),i(a,s.TOUCH_CANCEL,!1),a)),o._process_status=0,c.dragEnd&&c.dragEnd(e,r),c.click&&c.click(e,r);break;case l<o._max_points:if(o._process_status=s.IS_DRAG,e.targetTouches&&e.targetTouches.length>=o._max_points){var u=e.targetTouches,f=Array.isArray(u),p=0;for(u=f?u:u[Symbol.iterator]();;){var _;if(f){if(p>=u.length)break;_=u[p++]}else{if((p=u.next()).done)break;_=p.value}var h=_;if(-1===o._identifiers.indexOf(h.identifier)){o._registPoint(e,h);break}}}}},o.cursorUp=function(e){o.eventDispenser(e,o._leave)},o.keyDown=function(e){var r=o._process_values.kd_tasks;function n(t){if(t){for(var n=t._listeners?t._listeners.length:0,o=0;o<n;o++)if(!0===t._listeners[o](e,t._path))return!0;t._reference>n&&-1===r.indexOf(t)&&r.push(t)}}var i=t._PRIVATE_METHODS.get_keys(e);if(!r.some((function(e){return i.some((function(t){return n(e[t])}))}))){var a=i,s=Array.isArray(a),l=0;for(a=s?a:a[Symbol.iterator]();;){var c;if(s){if(l>=a.length)break;c=a[l++]}else{if((l=a.next()).done)break;c=l.value}var u=c;if(n(o._registered_listener.keyDown[u]))break}}},o.keyUp=function(e){for(var r=t._PRIVATE_METHODS.get_keys(e),n=o._process_values.kd_tasks,i=function(e){r.some((function(t){return-1!==n[e]._parts.indexOf(t)}))&&n.splice(e--,1),a=e},a=0;a<n.length;a++)i(a);var s=o._registered_listener.keyUp,l=r,c=Array.isArray(l),u=0;for(l=c?l:l[Symbol.iterator]();;){var f;if(c){if(u>=l.length)break;f=l[u++]}else{if((u=l.next()).done)break;f=u.value}var p=f;s[p]&&s[p].some((function(t){return t(e)}))}},o.keyPress=function(e){var r=t._PRIVATE_METHODS.get_keys(e),n=o._registered_listener.keyPress,i=r,a=Array.isArray(i),s=0;for(i=a?i:i[Symbol.iterator]();;){var l;if(a){if(s>=i.length)break;l=i[s++]}else{if((s=i.next()).done)break;l=s.value}var c=l;n[c]&&n[c].some((function(t){return t(e)}))}},o.registListener(r),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,e),f(t,[{key:"on",value:function(e,t){return this.updateListener(i({},e,t))}},{key:"off",value:function(e,t){return this.updateListener(i({},e,t),!0)}},{key:"activate",value:function(){this.updateListener()}},{key:"disable",value:function(){var e=this;this.setListener(Object.keys(this._listener_status).reduce((function(t,r){return e._listener_status[r]&&(t[r]=!1),t}),{}))}},{key:"updateListener",value:function(e,r){var n,o=this._registered_listener,a=t.STATES;if(e)for(var s in e)for(var l in t.PATTERN_MAP)t.PATTERN_MAP[l].test(s)&&(t._LISTENER_PREPROCESSOR[l]?e[s]&&t._LISTENER_PREPROCESSOR[l].call(this,s,e[s],r):o[l]=r?null:e[s]);this._max_points=o.pinch||o.rotate||o.dragMove2?2:1;var c=!!(o.dragStart||o.dragMove||o.dragMove2||o.dragEnd||o.click||o.pinch||o.rotate);return this.setListener((i(n={},a.MOUSE_DOWN,c),i(n,a.TOUCH_START,c),i(n,a.KEY_DOWN,o.keyDown._reference>0),i(n,a.KEY_UP,o.keyDown._reference>0||o.keyUp._reference>0),i(n,a.KEY_PRESS,o.keyPress._reference>0),n)),this}},{key:"_registPoint",value:function(e,r){var n,o=t.STATES,a=this._points,s=this._activated_listener;switch(a.push({dx:r.pageX,dy:r.pageY,mx:r.pageX,my:r.pageY}),this._identifiers.push(isNaN(r.identifier)?t.MOUSE_EVENT_ID:r.identifier),a.length){case 1:this._process_status=o.IS_DRAG;var l=this._is_mouse_event;this.setListener((i(n={},o.MOUSE_DOWN,l),i(n,o.MOUSE_MOVE,l),i(n,o.MOUSE_UP,l),i(n,o.TOUCH_MOVE,!l),i(n,o.TOUCH_END,!l),i(n,o.TOUCH_CANCEL,!l),n));break;case 2:this._process_values.sd=Math.sqrt(Math.pow(a[0].mx-a[1].mx,2)+Math.pow(a[0].my-a[1].my,2)),this._process_values.ra=Math.atan2(a[0].my-a[1].my,a[0].mx-a[1].mx),s.click&&(s.click=!1)}}},{key:"registListener",value:function(e){this.updateListener(e)}},{key:"removeListener",value:function(e){e&&this.updateListener(e,!0)}}]),t}(_);try{window.InputListener=h}catch(e){}e.exports=h}])}])}));